# Changelog

כל השינויים המשמעותיים בפרויקט Timrs יתועדו כאן.

## [2.2.0] - 2024-11-22

### 🐛 תיקוני באגים קריטיים

#### ✅ תיקון בעיית crypto.getRandomValues
- **הוספת react-native-get-random-values** - תיקון שגיאת UUID generation
  - הוספת polyfill עבור crypto.getRandomValues ב-React Native
  - ייבוא ראשוני ב-index.js לפני כל הקוד האחר
  - פתרון שגיאות Promise rejection ברקע

#### 🔧 תיקון באג סגירת חלון איפוס מותאם
- **CustomResetDialog סוגר אוטומטית** - החלון נסגר כעת אחרי איפוס מותאם
  - הוספת onClose() בסוף handleConfirm
  - הסרת setShowResetDialog מ-TimerCard (החלון מנהל את עצמו)
  - שיפור חווית משתמש

#### 🧹 ניקוי קוד יסודי
- **מחיקת ApiService** - הסרת קובץ שלא בשימוש עם 8 TODO items
- **הסרת useEffect מיותר** - ניקוי בדיקת שבירת שיא שיצר memory leaks
  - הוסר ה-useEffect שרץ בכל שינוי ב-currentStreak
  - הבדיקה נעשית כעת רק בזמן איפוס מותאם
  - הפחתת promises ברקע ושיפור ביצועים

#### 🔍 תיקון שגיאות Linting
- **ניקוי imports מיותרים** - הסרת useEffect ו-RecordBreak שלא בשימוש
- **תיקון scope conflicts** - החלפת משתנים כפולים (currentValue/resetValue)
- **אין שגיאות linting** - הקוד נקי לחלוטין

### 📦 תלויות חדשות
- `react-native-get-random-values` - polyfill עבור crypto ב-React Native

### 💪 שיפורים נוספים
- ניקוי console.log מיותרים
- שיפור טיפול בשגיאות
- אופטימיזציה של re-renders

---

## [2.1.0] - 2024-11-22

### 🔧 שיפורים קריטיים ואופטימיזציות

#### ✅ חישוב חודשים מדויק
- **תיקון חישוב חודשים** - החלפת חישוב פשטני של 30 יום לחישוב מדויק עם `date-fns`
  - שימוש ב-`differenceInCalendarMonths` לחישוב אמיתי של חודשים
  - שימוש ב-`addMonths` לחישובי איפוס מותאם של חודשים
  - תומך כעת בחודשים של 28, 29, 30 ו-31 ימים
  - חבילה חדשה: `date-fns`

#### 🔐 אבטחה משופרת
- **החלפת ID Generation ב-UUID** - IDs בטוחים יותר עם `uuid`
  - החלפת כל ייצור ה-IDs מ-`Date.now() + Math.random()` ל-`uuid v4`
  - מניעת collisions במקרים נדירים
  - תמיכה ב-IDs ייחודיים גלובליים
  - חבילה חדשה: `uuid`, `@types/uuid`

#### 🛡️ Firestore Security Rules
- **הוספת Security Rules** - הגנה מלאה על נתונים ב-Firebase
  - קובץ `firestore.rules` עם חוקי אבטחה מקיפים
  - הגנה ברמת משתמש - כל משתמש רואה רק את הנתונים שלו
  - מניעת גישה לא מורשית לכל הסוגים: timers, globalStats, deletedTimers, resetLogs, recordBreaks
  - מדריך מפורט ב-`FIRESTORE_RULES.md`

#### ⚡ ביצועים ו-Stability
- **תיקון Race Condition ב-SyncService**
  - שימוש ב-`Promise.all` למניעת race conditions
  - טיפול נכון בבדיקות אסינכרוניות של Firebase readiness
  - שיפור אמינות הסנכרון
  
- **Debounce ל-updateGlobalStats**
  - הפחתת כתיבות ל-AsyncStorage ולFirebase
  - עדכון רק כל 5 שניות במקום כל שנייה
  - עדכון רק אם יש שינוי ממשי בנתונים
  - שיפור משמעותי בביצועים ובאריכות סוללה

- **תיקון Memory Leak ב-HomeScreen**
  - שימוש ב-useRef למניעת re-creation של intervals
  - interval נוצר רק פעם אחת במקום בכל render
  - שיפור צריכת זיכרון ויציבות האפליקציה

#### 💪 Error Handling משופר
- **Error Recovery ב-TimerCard**
  - הצגת הודעות שגיאה ידידותיות למשתמש
  - אפשרות לניסיון חוזר במקרה של כשל
  - fallback מתאים בכל מצב
  - שיפור חווית המשתמש במצבי שגיאה

### 📦 תלויות חדשות
- `date-fns` - חישובי תאריכים מדויקים
- `uuid` - ייצור IDs בטוחים
- `@types/uuid` - TypeScript types ל-uuid

### 🔄 שינויים פורצי תאימות
- **שדה חדש ב-RecordBreak**: נוסף שדה `improvement` שמציין את גודל השיפור בשיא
  - הוגדר בכל מקום שנוצר RecordBreak
  - מחושב אוטומטית: `newRecord - oldRecord`

---

## [2.0.5] - 2024-11-22

### ✨ שיפורים גדולים במסך הגדרות
- **מחיקת SyncStatusIndicator המרחף** - הוסר האינדיקטור המעצבן שקפץ כל הזמן
- **כפתור הגדרות חדש** - כפתור פשוט ומינימליסטי במקום
- **מסך הגדרות מקיף ומשופר:**
  - 📋 **אודות** - גרסה ותיאור האפליקציה
  - 🔄 **סטטוס סנכרון** - מידע מפורט על הסנכרון (רק כשנדרש)
  - 📊 **Firebase** - סטטוס החיבור לענן
  - 📜 **היסטוריה** - קישורים מהירים לכל מסכי ההיסטוריה
  - 🐛 **דיווח באגים** - אפשרות נוחה לדווח על בעיות
  - ⚙️ **פעולות** - ניהול תור הסנכרון
- עיצוב מינימליסטי, נקי ומקצועי

---

## [2.0.4] - 2024-11-22

### 🎨 שיפורי חוויית משתמש
- **תיקון: תדירות עדכון SyncStatusIndicator** - שיפור חוויית המשתמש
  - שונתה תדירות עדכון תצוגת "timeAgo" מ-30 שניות לדקה אחת
  - מונע "קפיצות" מעצבנות בתצוגה
  - הסנכרון עצמו נשאר מהיר וזמין - רק התצוגה מתעדכנת פחות

---

## [2.0.3] - 2024-11-22

### 🔧 תיקוני סנכרון קריטיים
- **תיקון: איפוס מלא עכשיו שומר ResetLog** - איפוס מלא כעת מתועד במלואו
  - נוסף רישום אוטומטי של ResetLog באיפוס מלא
  - כולל: סיבה, ערך לפני ואחרי, timestamp
  - מסונכרן אוטומטית לענן
  
- **תיקון: מחיקה לצמיתות מסונכרנת** - `permanentlyDeleteTimer` עכשיו מוחק גם מהענן
  - נוספה פונקציה `deleteDeletedTimer` ל-FirebaseService
  - מחיקה לצמיתות כעת מסונכרנת ב-Firebase
  - מונע בעיות סנכרון בין מכשירים
  
- **תיקון: שחזור טיימר מסונכרן** - `restoreTimer` עכשיו מוחק מהענן
  - שחזור טיימר מוחק את ה-DeletedTimer גם מ-Firebase
  - מונע חזרה של טיימרים מחוקים לאחר סנכרון

### ✅ אימות מערכת שמירת הנתונים
- בוצעה סריקה מלאה ויסודית של כל נקודות שמירת הנתונים
- אומת שכל 5 סוגי הנתונים נשמרים ומסונכרנים:
  - ✅ Timers (יצירה, עדכון, מחיקה)
  - ✅ GlobalStats (סטטיסטיקות גלובליות)
  - ✅ DeletedTimers (היסטוריית מחיקות)
  - ✅ ResetLogs (לוגי איפוסים עם סיבות ומצב רוח)
  - ✅ RecordBreaks (שבירות שיא)
- אומתה שמירה אוטומטית בכל פעולה משמעותית
- וודא סנכרון מלא בין local ו-cloud

---

## [2.0.2] - 2024-11-22

### 🎨 עיצוב
- **אייקון אפליקציה חדש** - החלפת האייקון הדיפולטי באייקון מקצועי ומעוצב
  - עיצוב מותאם אישית עם שעון חול, כנפיים, כתר ואלמנטים טכנולוגיים
  - אייקונים בכל הגדלים הנדרשים ל-Android (mdpi, hdpi, xhdpi, xxhdpi, xxxhdpi)
  - אייקונים בכל הגדלים הנדרשים ל-iOS (AppIcon.appiconset)
  - תמיכה מלאה ב-round icons של Android

---

## [2.0.0] - 2024-11-22

### ✨ תכונות חדשות
- **סנכרון ענן עם Firebase** - הנתונים מסונכרנים אוטומטית לענן
- **תמיכה Offline-First** - האפליקציה עובדת רגיל גם ללא אינטרנט
- **אימות אנונימי** - שימוש ב-Firebase Anonymous Auth
- **מנגנון Queue לסנכרון** - שינויים נשמרים בתור ומסונכרנים כשחוזר אינטרנט
- **אינדיקטור סטטוס סנכרון** - מציג את מצב הסנכרון בזמן אמת
- **מסך הגדרות** - ניהול סנכרון, מעקב אחר סטטוס וניקוי cache

### 🏗️ שיפורי ארכיטקטורה
- **שכבת Utils משותפת** - פונקציות עזר לתאריכים, ולידציות ופורמט
- **Error Handler מרכזי** - טיפול מקיף בשגיאות עם logging
- **Error Boundary Component** - תפיסת שגיאות ב-React components
- **NetworkService** - ניטור מצב חיבור לאינטרנט
- **FirebaseService** - שכבת abstraction מעל Firebase
- **SyncService** - ניהול חכם של סנכרון בין local ל-cloud

### 🐛 תיקוני באגים
- תוקן ממשק `RecordBreak` - איחוד 3 הגדרות כפולות לאחת אחידה
- הוספת שדה `improvement` ל-`RecordBreak`
- תיקון circular dependency ב-StorageService

### ⚡ אופטימיזציות
- שימוש ב-`React.memo` ב-TimerCard לביצועים טובים יותר
- שימוש ב-`useMemo` ו-`useCallback` לחישובים כבדים
- Custom comparison function ב-memo למניעת re-renders מיותרים

### 🔒 אבטחה ווולידציות
- הוספת `ValidationRules` עם הגבלות ברורות
- פונקציות ולידציה לכל שדות הקלט
- sanitization של input למניעת ערכים לא תקינים
- הגבלת אורך טקסט ב-reset logs ושמות טיימרים

### 📦 חבילות חדשות
- `@react-native-firebase/app` - ליבת Firebase
- `@react-native-firebase/firestore` - מסד נתונים בענן
- `@react-native-firebase/auth` - אימות משתמשים
- `@react-native-community/netinfo` - ניטור מצב רשת

### 📝 שינויים נוספים
- עדכון גרסה ל-2.0.0
- הוספת קובץ `FIREBASE_SETUP.md` עם הוראות הגדרה
- שיפור תיעוד בכל הקבצים
- הוספת הערות עברית מפורטות בקוד

---

## [1.4.0] - 2024-11-XX (גרסה קודמת)

### תכונות
- רישום שבירות שיאים (Record Breaks)
- היסטוריית איפוסים עם מצב רוח וסיבות
- סטטיסטיקות גלובליות
- מסך היסטוריה לטיימרים מחוקים

---

## [1.0.0] - 2024-11-XX (גרסה ראשונה)

### תכונות בסיסיות
- יצירת טיימרים מותאמים אישית
- בחירת יחידות זמן (שניות, דקות, שעות, ימים, שבועות, חודשים)
- איפוס מותאם ואיפוס מלא
- עריכה ומחיקה של טיימרים
- שמירה מקומית ב-AsyncStorage
- עיצוב מודרני RTL

---

## הערות גרסאות

### סמנטיקת גרסאות
אנחנו משתמשים ב-[Semantic Versioning](https://semver.org/):
- **MAJOR** - שינויים שאינם תואמים לאחור
- **MINOR** - תכונות חדשות תואמות לאחור
- **PATCH** - תיקוני באגים תואמים לאחור
